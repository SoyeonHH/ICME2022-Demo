<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/style/common.css" type="text/css">
    <link rel="stylesheet" href="./style/analysis.css" type="text/css">
  </head>
  <body>
    <div class="header">
      <div class="header-leading">
        <span style="color: green">MM</span><span style="color: red">S</span><span style="color: purple">A</span>
      </div>
      <div class="header-github"><img src="./image/github.png" /></div>
      <div class="header-item">Comparision</div>
      <div class="header-item selected">Analysis</div>
      <a href="http://localhost:3000"><div class="header-item">View</div></a>
    </div>
    <div class="section">
      <h1>Analysis</h1>
      <div id="workspace">
        <table id="viewMenu">
          <th>View</th>
          <th>Analysis</th>
          <th>Compare</th>
          <th>Upload</th>
        </table>
      </div>
      <div id="barGraph">
        <h2>Gold vs Our Accuracy</h2>
        <div id="canvasList">
          <canvas id='graph_class_2'  width="400" height="400"></canvas>
          <canvas id='graph_class_7'  width="400" height="400"></canvas>
        </div>
      </div>
      <div id="p-barVideos">
        <h2>Video Accuracy</h2>
        <table id="videoAcc">
          <th></th>
          <th>Video_0</th>
          <th>Video_1</th>
          <th>Video_2</th>
          <tr>
            <td>2 Class</td>
            <td><progress value='70' max='100'></progress></td>
            <td><progress value='50' max='100'></progress></td>
            <td><progress value='40' max='100'></progress></td>
          </tr>
          <tr>
            <td>7 Class</td>
            <td><progress value='40' max='100'></progress></td>
            <td><progress value='70' max='100'></progress></td>
            <td><progress value='60' max='100'></progress></td>
          </tr>
        </table>
      </div>
      <div id="p-barSengment">
        <h2>Segment Hit</h2>
        <h3>Video_0<h3>
        <table id="segmentAcc">
          <th></th>
          <th>id_0</th>
          <th>id_1</th>
          <th>id_2</th>
          <tr>
            <td>2 Class</td>
            <td><progress value='100' max='100'></progress></td>
            <td><progress value='0' max='100'></progress></td>
            <td><progress value='100' max='100'></progress></td>
          </tr>
          <tr>
            <td>7 Class</td>
            <td><progress value='0' max='100'></progress></td>
            <td><progress value='0' max='100'></progress></td>
            <td><progress value='100' max='100'></progress></td>
          </tr>
        </table>
      </div>
      <div id="viewSegment">
        <h2>View Segment</h2>
        <h3>Video_0 id_0</h3>
      </div>
    </div>
    
    <div class="footer">
      <div class="footer-content">
        <div class="footer-title">
          <span style="color: green">M</span>ulti<span style="color: green">M</span>odal <span style="color: red">S</span>entiment <span style="color: purple">A</span>nalysis
        </div>
        <div class="footer-info">
          <div><a href="https://sites.google.com/view/iknow-lab">
            <svg xmlns="http://www.w3.org/2000/svg" width="10px" height="10px" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 9v11a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9"/><path d="M9 22V12h6v10M2 10.6L12 2l10 8.6"/></svg>
            iKnow Lab Ajou Univ.</a></div>
          <div>&copy; Soyeon.H</div>
          <div><a href="mailto:sodus1102@ajou.ac.kr">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width='10px' height='10px'><path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"/></svg>
            sodus1102 at ajou.ac.kr</a></div>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="./script/chart.js-3.7.1/package/dist/chart.js"></script>
    <script>
    /*
  const labels = [
    '-3',
    '-2',
    '-1',
    '0',
    '1',
    '2',
    '3',
  ];


  const data = {
    labels: labels,
    datasets: [{
      label: 'Gold',
      backgroundColor: 'rgb(255, 99, 132)',
      borderColor: 'rgb(255, 99, 132)',
      data: [80, 70, 50, 60, 30, 30, 45],
    },
    {
      label: 'Our',
      backgroundColor: 'rgb(122, 99, 132)',
      borderColor: 'rgb(122, 99, 132)',
      data: [50, 60, 40, 30, 30, 30, 45],
    }]
  };

  const config = {
    type: 'bar',
    data: data,
    options: {
      scales: {
        y: {
          beginAtZero: true,
          suggestedMax:100
        }
      }
    },
  };
  const myChart = new Chart(
    document.getElementById('myChart'),
    config
  );*/


  const labels2class = [
    'Negative',
    'Positive'
  ]
  const labels7class = [
    "Very Negative",
    "Negative",
    "Slightly Negative",
    "Neutral",
    "Slightly Positive",
    "Positive",
    "Very Positive",
  ]

  const config = {
    options: {
      responsive: false,
      scales: {
        y: {
          beginAtZero: true,
          suggestedMax:100
        }
      }
    },
  };

  function Model(modelName, publisher, result) {
    this.modelName = modelName
    this.publisher = publisher
    this.result = result //result on every segment

    this.uploadModel = function(modelName, publisher, inputFile) {
      //update attributes
      this.modelName = modelName
      this.publisher = publisher

      //process input file and make this.result

    }

    this.getClassAcc = function() {//return class accuracy from model's result file
      var returnAcc2 = [0,0]
      var returnAcc7 = [0,0,0,0,0,0,0]

      if(this.result) {//result exist.
        //2 class result
        var cnt2class = [0,0]
        var hit2class = [0,0]

        for (var i = 0; i < this.result.length; i++) {
          var j = -1
          switch(result[i][4]) {
            case 'negative'         : j = 0; break;
            case 'positive'         : j = 1; break;
            default : break; //err uknown class
          }

          cnt2class[j] = cnt2class[j] + 1
          if(result[i][4] == result[i][7]) {//hit
            hit2class[j] = hit2class[j] + 1
          }
        }

        for (var i = 0; i <2; i++) {
          returnAcc2[i] = hit2class[i] / cnt2class[i] * 100
        }


        var cnt7class = [0,0,0,0,0,0,0]
        var hit7class = [0,0,0,0,0,0,0]

        for (var i = 0; i < this.result.length; i++) {
          var j = -1
          switch(result[i][5]) {
            case 'very negative'    : j = 0; break;
            case 'negative'         : j = 1; break;
            case 'slightly negative': j = 2; break;
            case 'neutral'          : j = 3; break;
            case 'slightly positive': j = 4; break;
            case 'positive'         : j = 5; break;
            case 'very positive'    : j = 6; break;
            default : break; //err uknown class
          }

          cnt7class[j] = cnt7class[j] + 1
          if(result[i][5] == result[i][8]) {
            hit7class[j] = hit7class[j] + 1
          }
        }

        for (var i = 0; i <7; i++) {
          returnAcc7[i] = hit7class[i] / cnt7class[i] * 100
        }
      }

      return [returnAcc2, returnAcc7]
    }
  }

  function Analysis(goldModel, model) {

    this.goldModel = goldModel
    this.model = model
    this.graph2 = document.getElementById('graph_class_2').getContext("2d");
    this.graph7 = document.getElementById('graph_class_7').getContext("2d");
    this.currentVideo = 0
    this.currentClip = 0

    this.updateGraph = function(){
      //create class accuracy bar-graph
      var analysisDataset2;
      var analysisDataset7;

      if(this.model) {//our model is uploaded
        var goldData = this.goldModel.getClassAcc()
        var ourData = this.model.getClassAcc()

        console.log(goldData[0])
        console.log(ourData[0])

        analysisDataset2 = {
          labels: labels2class,
          datasets: [{
            label: 'Gold',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: goldData[0],
          },
          {
            label: 'Our',
            backgroundColor: 'rgb(122, 99, 132)',
            borderColor: 'rgb(122, 99, 132)',
            data: ourData[0],
          }]
        };

        analysisDataset7 = {
          labels: labels7class,
          datasets: [{
            label: 'Gold',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: goldData[1],
          },
          {
            label: 'Our',
            backgroundColor: 'rgb(122, 99, 132)',
            borderColor: 'rgb(122, 99, 132)',
            data: ourData[1],
          }]
        };

      } else {//no model has been uploaded show only gold Model results
        var goldData = this.goldModel.getClassAcc()

        analysisDataset2 = {
          labels: labels2class,
          datasets: [{
            label: 'Gold',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: goldData[0],
          }]
        };

        analysisDataset7 = {
          labels: labels7class,
          datasets: [{
            label: 'Gold',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: goldData[1],
          }]
        };
      }

      var chart0 = new Chart(this.graph2, {
        type: 'bar',
        data: analysisDataset2,
        config}
      );

      var chart1 = new Chart(this.graph7, {
        type: 'bar',
        data: analysisDataset7,
        config}
      );

    }

    this.updatePbarVideo = function(video_id){//Draw Progress Bar of a single Video
      //process this.result via video

      //create per video progress bar

    }

    this.updatePbarSegment = function(segment_id) {//Draw Progress Bar of a single Segment
      //process this.result via video

      //create per segment progress bar

    }

    this.updateView = function(video_id) { //Show Video's video, sound, text

    }

    this.changeVideo = function(video_id) {//When video is chosen hilgiht selected video, Update Prgroess bar for every Segment, update View
      //highlight Selected Video

      //create progress bar for every segment
      while(false) {
        this.updatePbarSegment()
      }

      //update View

    }
  }


  var goldTestResult = [["abcd",0,"text1",-0.5,'negative','slightly negative',-0.4,"negative",'slightly negative']
                       ,["abcd",1,"text1",-1.5,'negative','negative',-0.3,"negative",'slightly negative']
                       ,["abcd",2,"text1", 2.5,'positive','very positive',0,'positive',"neutral"]
                       ,["abcd",3,"text1", 0.5,'positive','slightly positive',0.7,"positive",'slightly positive']
                       ,["abcd",4,"text1",-2.5,'negative','very negative',-2.4,"negative",'very negative']
                       ,["abcd",5,"text1", 0.3,'positive','neutral',-0.4,"negative",'slightly negative']
                       ,["abcd",6,"text1", 1.0,'positive','positive',1.0,"positive",'positive']];
  var ourTestResult =  [["abcd",0,"text1",-0.5,'negative','slightly negative',-0.4,"negative",'slightly negative']
                       ,["abcd",1,"text1",-1.5,'negative','negative',-0.3,"negative",'slightly negative']
                       ,["abcd",2,"text1", 2.5,'positive','very positive',-0.3,"negative",'slightly negative']
                       ,["abcd",3,"text1", 0.5,'positive','slightly positive',1.7,"positive",'positive']
                       ,["abcd",4,"text1",-2.5,'negative','very negative',-2.4,"negative",'very negative']
                       ,["abcd",5,"text1", 0.3,'positive','neutral',-0.4,"negative",'slightly negative']
                       ,["abcd",6,"text1", 1.0,'positive','positive',1.0,"positive",'positive']];

  var goldModel = new Model("GOLD", "donghoon", goldTestResult)
  var ourModel = new Model("OUR","notDonghoon",ourTestResult)
  var analysis = new Analysis(goldModel, ourModel)

  analysis.updateGraph()

  </script>
  </body>
</html>
